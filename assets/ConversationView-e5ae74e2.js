import{i as N,a as P,b as z,c as F,d as K,e as L,f as Q,g as R,h as G,j as H,k as J}from"./index-43a7aeec.js";import{_ as O,g as W,r as g,o as X,s as w,h as q,p as D,T as x,B as C,a as Y,d,e as u,f as e,F as M,k as U,t as h,l as S,j as Z,v as $,m as v,Q as ee,q as E,A as se,K as te,n as T}from"./index-0729dbfe.js";const oe={props:{convo_ID:{type:String,default:null}},data(){const k=W(),f=g([]),l=g([]),_=g({}),s=g(""),I=g();let n="",m=[];const y=g({});X(async()=>{const o=w(x(v,"conversations"),D("participants","array-contains-any",[this.$store.state.user.email]),q("updated_At","desc")),r=await C(o);for(const a of r.docs){const i={chatID:a.id,chatTopic:a.data().chat_Topic,createdAt:a.data().created_At,participants:a.data().participants,updatedAt:a.data().updated_At};m.push(i)}if(f.value=m,this.convo_ID!=null){const a=this.conversations.find(i=>i.chatID===this.convo_ID);b(a)}Y(k,a=>{a&&A(a.uid)}),N(),P(),z(),F(),K(),L(),Q(),R(),G(),H(),J()});async function A(o){const r=w(x(v,"users"),D("uid","==",o));(await C(r)).forEach(i=>{const t={username:i.data().username,email:i.data().email};y.value=t})}async function b(o){let r=[];_.value=o;const a=w(x(v,"messages"),D("chat_id","==",o.chatID),q("created_at")),i=await C(a);for(const t of i.docs){const c={messageID:t.id,chatID:t.data().chat_id,createdAt:t.data().created_at,messageContent:t.data().message_content,sender:t.data().sender_email};r.push(c)}l.value=r}function j(o){const r={year:"numeric",month:"long",day:"numeric"},a=o.toDate().toLocaleString("en-US",r);var t=new Date-o.toDate();t=t/1e3;var c=" second(s) ago",p=Math.floor(t);return t>60&&t<3600?(p=Math.floor(t/60),Math.floor(t/60)>1?c=" mins ago":c=" min ago"):t>3600&&t<86400?(p=Math.floor(t/3600),Math.floor(t/3600)>1?c=" hrs ago":c=" hr ago"):t>86400&&t<604800?(p=Math.floor(t/86400),Math.floor(t/86400)>1?c=" days ago":c=" day ago"):t>604800?(p=a,c=""):(p=Math.floor(t),c="s ago"),p+c}function B(o,r){ee(x(v,"messages"),{chat_id:o.chatID,created_at:E.now(),message_content:s.value,sender_email:r}).then(a=>{b(o),s.value="";const i=se(v,"conversations",o.chatID);te(i,{updated_At:E.now()})})}function V(o,r){var a="";return o+1<l.value.length&&l.value[o].sender==l.value[o+1].sender&&(a+=l.value[o].sender==r?" rounded-br-none":" rounded-bl-none"),o-1>=0&&l.value[o].sender==l.value[o-1].sender&&(a+=l.value[o].sender==r?" rounded-tr-none":" rounded-tl-none"),a+=l.value[o].sender==r?" bg-green-700 text-white":" bg-gray-300",a}return{conversations:f,getCurrentUser:A,currentUser:y,calculateTimeElapsed:j,convoMessages:l,isSameMessageSource:V,loadMessages:b,sendMessage:B,currentConvo:_,activeTab:n,messageDraft:s,scrollToElement:I}}},ae=e("button",{"data-drawer-target":"default-sidebar","data-drawer-toggle":"default-sidebar","aria-controls":"default-sidebar",type:"button",class:"inline-flex items-center p-2 mt-2 ml-3 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"},[e("span",{class:"material-symbols-outlined"},"menu")],-1),ne={class:"flex flex-row py-0 sm:py-10 bg-gray-100 h-[92vh] sm:h-[100vh]"},re={id:"default-sidebar",class:"fixed top-10 left-0 z-40 flex bg-white flex-col py-4 h-4/5 rounded-xl transition-transform -translate-x-[108%] sm:translate-x-5","aria-label":"Sidebar"},le=e("div",{class:"flex mx-4 mb-4 px-7 flex-row bg-green-400 rounded-full"},[e("input",{class:"block w-full p-2 text-sm text-gray-900 rounded-full border-0 bg-transparent placeholder:text-white focus:ring-0 focus:outline-none",type:"search",placeholder:"Search chats here..."}),e("button",{class:"material-symbols-outlined"},"Search")],-1),ie={class:"h-full py-4 overflow-y-auto dark:bg-gray-800"},ce={class:"font-medium border-y"},de={class:"border-y py-1"},ue=["onClick"],fe={class:"flex flex-row justify-between"},me={class:"font-bold text-xl"},he={class:"text-sm font-normal"},pe={class:"font-normal"},ge={key:0,class:"bg-white flex flex-col mx-0 sm:mx-5 sm:ml-80 h-full sm:h-[80vh] w-screen rounded-xl",ref:"scrollToElement"},ve={class:"bg-green-500 w-full flex flex-row items-center justify-between rounded-t-xl p-2"},xe={class:"flex flex-col"},_e={class:"font-bold text-xl"},ye=e("div",{class:"flex flex-row"},[e("span",{class:"material-symbols-outlined"}," delete "),e("span",{class:"material-symbols-outlined"}," block "),e("span",{class:"material-symbols-outlined"}," report ")],-1),be={class:"h-full bg-white overflow-y-auto px-4"},we={key:0,class:"flex justify-center"},De={class:"flex p-3 flex-row h-[15%] bg-white rounded-b-xl"},Ce={key:1,class:"flex items-center justify-center flex-col mx-5 sm:ml-80 h-[80vh] w-screen rounded-xl"},Me={class:"text-xl"};function Se(k,f,l,_,s,I){return d(),u(M,null,[ae,e("div",ne,[e("aside",re,[le,e("div",ie,[e("ul",ce,[(d(!0),u(M,null,U(s.conversations,(n,m)=>(d(),u("li",de,[e("a",{href:"#",onClick:y=>{s.loadMessages(n),s.activeTab="convo"+m},class:T([{"bg-green-400":s.activeTab==="convo"+m},"flex flex-col px-2"])},[e("div",fe,[e("span",me,h(n.chatTopic),1),e("span",he,h(s.calculateTimeElapsed(n.updatedAt)),1)]),e("span",pe,h(n.participants[0]!=s.currentUser.email?n.participants[0]:n.participants[1]),1)],10,ue)]))),256))])])]),s.currentConvo.chatID!=null?(d(),u("div",ge,[e("div",ve,[e("div",xe,[e("h1",_e,h(s.currentConvo.chatTopic),1),e("p",null," Participant: "+h(s.currentConvo.participants[0]!=s.currentUser.email?s.currentConvo.participants[0]:s.currentConvo.participants[1]),1)]),ye]),e("div",be,[(d(!0),u(M,null,U(s.convoMessages,(n,m)=>(d(),u("div",{class:T([n.sender==s.currentUser.email?"flex-row-reverse":"flex-row","my-1 flex items-end gap-2"])},[e("div",{class:T(["max-w-md rounded-3xl px-4 py-3",s.isSameMessageSource(m,s.currentUser.email)])},[e("p",null,h(n.messageContent),1)],2)],2))),256)),s.convoMessages.length==0&&s.currentConvo.chatID!=null?(d(),u("div",we," No messages yet ")):S("",!0)]),e("div",De,[Z(e("input",{"onUpdate:modelValue":f[0]||(f[0]=n=>s.messageDraft=n),class:"rounded-l-lg w-full bg-green-400 border-0 focus:ring-0 focus:outline-none placeholder:text-white",type:"text",placeholder:"Type your message here..."},null,512),[[$,s.messageDraft]]),e("button",{onClick:f[1]||(f[1]=n=>s.sendMessage(s.currentConvo,s.currentUser.email)),class:"material-symbols-outlined bg-green-400 px-2 rounded-r-lg hover:bg-green-700"}," Send ")])],512)):S("",!0),s.currentConvo.chatID==null?(d(),u("div",Ce,[e("p",Me," Select a conversation to load messages "+h(l.convo_ID),1)])):S("",!0)])],64)}const Ie=O(oe,[["render",Se]]);export{Ie as default};
